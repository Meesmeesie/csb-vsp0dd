{
    "componentChunkName": "component---src-templates-learn-tsx",
    "path": "/learn/the-nodejs-event-loop",
    "result": {"data":{"doc":{"id":"f9c4ac82-50e2-5f98-90e2-a1655cef84b6","html":"<h2 id=\"introduction\" style=\"position:relative;\"><a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"autolink-headers before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h2>\n<p>The <strong>Event Loop</strong> is one of the most important aspects to understand about Node.js.</p>\n<p>Why is this so important? Because it explains how Node.js can be asynchronous and have non-blocking I/O, and so it explains basically the \"killer app\" of Node.js, the thing that made it this successful.</p>\n<p>The Node.js JavaScript code runs on a single thread. There is just one thing happening at a time.</p>\n<p>This is a limitation that's actually very helpful, as it simplifies a lot how you program without worrying about concurrency issues.</p>\n<p>You just need to pay attention to how you write your code and avoid anything that could block the thread, like synchronous network calls or infinite loops.</p>\n<p>In general, in most browsers there is an event loop for every browser tab, to make every process isolated and avoid a web page with infinite loops or heavy processing to block your entire browser.</p>\n<p>The environment manages multiple concurrent event loops, to handle API calls for example. Web Workers run in their own event loop as well.</p>\n<p>You mainly need to be concerned that <em>your code</em> will run on a single event loop, and write code with this thing in mind to avoid blocking it.</p>\n<h2 id=\"blocking-the-event-loop\" style=\"position:relative;\"><a href=\"#blocking-the-event-loop\" aria-label=\"blocking the event loop permalink\" class=\"autolink-headers before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Blocking the event loop</h2>\n<p>Any JavaScript code that takes too long to return back control to the event loop will block the execution of any JavaScript code in the page, even block the UI thread, and the user cannot click around, scroll the page, and so on.</p>\n<p>Almost all the I/O primitives in JavaScript are non-blocking. Network requests, filesystem operations, and so on. Being blocking is the exception, and this is why JavaScript is based so much on callbacks, and more recently on promises and async/await.</p>\n<h2 id=\"the-call-stack\" style=\"position:relative;\"><a href=\"#the-call-stack\" aria-label=\"the call stack permalink\" class=\"autolink-headers before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The call stack</h2>\n<p>The call stack is a LIFO (Last In, First Out) stack.</p>\n<p>The event loop continuously checks the <strong>call stack</strong> to see if there's any function that needs to run.</p>\n<p>While doing so, it adds any function call it finds to the call stack and executes each one in order.</p>\n<p>You know the error stack trace you might be familiar with, in the debugger or in the browser console? The browser looks up the function names in the call stack to inform you which function originates the current call:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e4594b6135efd353b44770f748fdccd5/1b853/exception-call-stack.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 104.05405405405406%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAIAAADJt1n/AAAACXBIWXMAAAsTAAALEwEAmpwYAAACHUlEQVQ4y51UW3OiMBTm//+lPvVlt9XRFq21qMBWVBIuCZCEXLhkD9Zud2xrt3vmy0w4nO/cwdGNkWlN3ETuKj9kaF8pXsQ4LfGOZKnSpu/6tu36vrfvxAGt0YaFRfmQ5h6hy4z4ibt4dF13vfHXm2C7jaLdXik1mIOL/s2PA4fXYlCA6g/syfKyDOSWm3rHmkLhRFIqG10zLowoa87TLM9yQmhBKM0JVUmiEVJSvpFNpUVUNaVCiSR53Sghaml4IVgVoyRJMyAD84CwTlO9fy3hRC6VeC4bqtJMpalotKgY14ywqmy77ou0e93Ffuw/+Y9PYRgewiDwg1CFPvU8LsSx+JOcN+zlug7ChycPYQzvJMzHGNt1nTH9xaYNkZum3UZ7P/jFGLffkYFcS3kW4fT41ayOc+biEKOiLO03ZSBnOQ2eI6n132vyL3AsLQqYph9YaGxR2KqylFroHFwgFwBjFgb7ERzz87byVu1sZicTe31tFws7HnVXV2Y8MT9u25vbfrkcXIDHd3AsZzrPV+7MZNlLqL4q9+H2ZopHd3i+SGVW2LIYknoHB06bk523guUaMgQy1LEJRlM0vsPuDIuEXCL3lB5Wa7qNaowFQhLjw/pInqLZPKGHS2TaAdlbRY9Lfzb33TlarffeZjyNR5P4/h49bxKw+bhmxZUgtNcaFu0VxsJ6tqA5wuhPu60aCx/g+Yad/xc+X5L/lt/VprexZG0NSgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Exception call stack\"\n        title=\"Exception call stack\"\n        src=\"/static/e4594b6135efd353b44770f748fdccd5/fcda8/exception-call-stack.png\"\n        srcset=\"/static/e4594b6135efd353b44770f748fdccd5/12f09/exception-call-stack.png 148w,\n/static/e4594b6135efd353b44770f748fdccd5/e4a3f/exception-call-stack.png 295w,\n/static/e4594b6135efd353b44770f748fdccd5/fcda8/exception-call-stack.png 590w,\n/static/e4594b6135efd353b44770f748fdccd5/1b853/exception-call-stack.png 592w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"a-simple-event-loop-explanation\" style=\"position:relative;\"><a href=\"#a-simple-event-loop-explanation\" aria-label=\"a simple event loop explanation permalink\" class=\"autolink-headers before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>A simple event loop explanation</h2>\n<p>Let's pick an example:</p>\n<iframe\n  title=\"A simple event loop explanation\"\n  src=\"https://glitch.com/embed/#!/embed/nodejs-dev-0029-01?path=server.js&previewSize=20&attributionHidden=true&sidebarCollapsed=true\"\n  alt=\"nodejs-dev-0029-01 on Glitch\"\n  style=\"height: 400px; width: 100%; border: 0;\">\n</iframe>\n<!--```js\nconst bar = () => console.log('bar')\n\nconst baz = () => console.log('baz')\n\nconst foo = () => {\n  console.log('foo')\n  bar()\n  baz()\n}\n\nfoo()\n```\n\nThis code prints\n\n```txt\nfoo\nbar\nbaz\n```\n\nas expected.-->\n<p>When this code runs, first <code class=\"language-text\">foo()</code> is called. Inside <code class=\"language-text\">foo()</code> we first call <code class=\"language-text\">bar()</code>, then we call <code class=\"language-text\">baz()</code>.</p>\n<p>At this point the call stack looks like this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/270ebeb6dbfa7d613152b71257c72a9e/11a8f/call-stack-first-example.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 104.72972972972974%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAIAAADJt1n/AAAACXBIWXMAAAsTAAALEwEAmpwYAAADoklEQVQ4y11UW2/cRBTeX4V4QYCEeAWEEKA+IS7iBQkkeEiKhAoPFFraVA1VFImCKE3VVKgtgtI0tLk3SUuSvSShaXY3m+x6b7HnfrPHHnO8m0Zp7bF8Pvt8M/b3nTO5KIqMMUopzrnWWggBUAgppDwCAcl+DA8hE/LDMMzB5ZxLe0eSJJCUPjmstUchkOM47sfOJQdkmyTWOZu4KI6zbJdkI3WxjaRSiUvhFQxYPYqTyKWhS03inlq5dyWVDhpa644Uu2fz/p/lIJT8cGUuNNqZEKWvbfETVRxkuJOR60T/h0wxMDtENQMyWtofLqFTBTRVw4SyR0hvIlMK9D4Re/XiaunGSun3ldIfGAc5bczp1e7rU8Fzd+inS37DJ8cX2+/M4Zf+IVcfo5Xd7rtT3Vfvkefv4KVa93qZvzmjX5hOX5sxXkBzoLbiVGeDQKBAVcaU4HADfZUQWjAtuOY9KCEgRhDIF4LnQENtrJAhZUrpqG8Do9kJ4gEE0yglnDPRewX5hOCMpXVGtrId8R3Lq4Y3emo7UDpNYwtqS/WMVeCEdYlN4kxtmNt/NNbMj3iFi93NS+DNYTak9qHrDZgXCuGJzz2r4JP2K7eCjR/x+rf+1hgOOkFtku2Mi8pF7C0LaQ7Jiot/O9uXvfvnm3d/akwjRnPw6ah8g2/8oIpf0a1fCWoF66N8/aQsHCc7E1KGaRzBH7g4MkJNeqvflK99Ubl8ojzewX7OmHC4RI4t6Jdn04EV1UBs4CF9ezF+cTa9WlGF+v77c/4bs+yVe+zhnn+7yj5e4G/NJx8tqDZimVWbbbzUQPN1VGwGlPE1L1jy0Nweqvmki+lygyx7bL5OOojuBux+Hc81yGI9wJTlQIbYSKd4LFiss95JtLAQCxoqqWQf0kQyLQU8SRS3nCRKaKVy4F4YRuAxlQKM5lwYa6HfZBhC8QGMbKxNqCMLvoRRFNpYhZGJLLQn+Mx/8WZO1/4aqv09undXP22VOgIhftYqgsn1+vJIdfJ8dWKsNhdglKe7D2hlgW6XSUuJrJ+hK8Eqxhh0eJ95QIbfulKbHqheeq86PFS7WQ9aJx+Pf17++dj2mfH6bKIid2Czk4If2Qx6ZBOGV7bag6udDx/gc+v7LczOFppfrvkfLOPbNbzdRmeKaDAvPlvheQ8Brb9tQdDfDMytcnChhE8VyPhW0EHkt41gZJ18VwA/cLnlXyj650r4+zza8PwkMlCwUPBQWjDF/5kAcki3L5BYAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Call stack first example\"\n        title=\"Call stack first example\"\n        src=\"/static/270ebeb6dbfa7d613152b71257c72a9e/fcda8/call-stack-first-example.png\"\n        srcset=\"/static/270ebeb6dbfa7d613152b71257c72a9e/12f09/call-stack-first-example.png 148w,\n/static/270ebeb6dbfa7d613152b71257c72a9e/e4a3f/call-stack-first-example.png 295w,\n/static/270ebeb6dbfa7d613152b71257c72a9e/fcda8/call-stack-first-example.png 590w,\n/static/270ebeb6dbfa7d613152b71257c72a9e/efc66/call-stack-first-example.png 885w,\n/static/270ebeb6dbfa7d613152b71257c72a9e/c83ae/call-stack-first-example.png 1180w,\n/static/270ebeb6dbfa7d613152b71257c72a9e/11a8f/call-stack-first-example.png 1272w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>The event loop on every iteration looks if there's something in the call stack, and executes it:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 466px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ca404c319c6fc595497d5dc097d469ff/fc1a1/execution-order-first-example.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 164.86486486486487%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAhCAIAAABWXBxEAAAACXBIWXMAAAsTAAALEwEAmpwYAAAE4klEQVQ4y6WVW2zbZBTHoz3ygEBM4oUHEE8INoTGAwKB0CYxpD3wwAPTEGMtaA2rmARDu5bS0m5ctA2QxjbW3ZBgo0NdUdcyGFu7pWuTtVmTJl0TO04aJ3ac2I7j+yXxhWM3vTClAomjv46OLJ2cnN/3/2yfs0LY/yYIX8NO0zQtVXK0FVVVZdt2fJZpZjJzc3NZHMcpihJFCZoVSeyYZJqDgj/ItwR5f2hJO0L81nHhpzgFI3y2bcuyUqSKeBYnSYKmaSKXpwhiwy3lwEjmZCiz9g/xgQH94SvaQ55WD2q+fn3/ZNltvn9V211HEUV/sPJOSNl+R3pjVN54S359QZsC8kvDyrEoXW+2LMteFvCkVq0W2TLOcDhTKTAVigVxXnZVYDiW42FOA2DQ7/6cJjoa70oVHE1wVN7LUMNzwdQVGOKzLDOH5wiCKBQohmYkSYZ+VZJOzHD74kZ7XG+Lqfunlba4tjciH4hp7VHp02n5Cko7NgCzrHK5DKhTGDYPnCTJIkmuH5F33kh3Xr/XcRP7YjzXPowcDlNdw7MfB1nfZWPfBLsEbH5b+LdwwtVqVaxwm2+LW8YkwLY9JPon5KZRdkdY8YeErSHliT+NL+8yQGYJ2PK1DV1PU6VooQyKkGyEYKNkOUIwUZKNkSxSoPMlZkVgEJpmapqj6yDb0G1dswyvMDRbU23DsBwPmEUVizTNsGyZr1RkRXHPWVbY9JAy96OInefTv/DpS8v0q4D9TGeDJtgTFgVIaSyNIii4FKzG0kyxyEh3tuCjuwpTR8TAeiOwRg+s0wPPuRp93hh5kot9bS5eDJgPxoAwDEOSJJbl5MkmJtTKT3eqwU367Rf1sVf0sZddjb9qBJ4tx76pN/+Dllerqsbm74rEiJAbruTHK0SII4KQPd2p5McYMmHZjq+xvSxL1ixBdUTNlQR5vla9WnG0BWAmmEQQREEQFEXRgK87WWXwMQEfEvHfheyQkB2Emp8bhKIyd5XLXqfzMWseGNgTQVIguNelUkkS3Z2VcBMX/oSa7CyFO9hot5vvdlDhLj6yuza6hosfrS0CA06qqswHywBtWp7YQt7+MDPaRgTbi+HuTGAfO9WVHe8UY3v1G4+Xo1/VgVnLgNXvs6LQ6WtC+qKY7oXMYxcWM5fqLWN9xexEA2ALbnWsWl0myHSztZDd56ZddxjMqRruCddqNaNahae6pt0roOPF+BgVn6KS0xQyXc+uIlQiXcw6tkcbw7DZRCKRRDKZDLgU+kWOfzN57K17xz5InHthtvupRPszic+e9rQ20fnY7J5DqX5n8W/DcDgqnufhzAokWSKpDcnDreFTRxK/rZlpf3Bm5+qZjx7x9OjMrlUx/4FUb70ZdrwfmCQfR67uxi7uQS92on0H0cvdCzqE9rchlwawoGM1cJgLzPlv4b634e3hutKbaQJNxwF6OZpEmdyiEE9QYEw+y5AUW3LmvxgoCtcxhaawHI7Dxfbe21Izenozerw52bMNOd2cOrsN6Xk3eaop0fM28sM6pOtbbKi+M4wFVIwXHFch8gRFFF5LHf083nsiMvB9fLAH+eu7qf4zqWsnI4Pd2f5VMy1tqUtOw1vlTZYPJvveS572J8+1JM+CtnsZ1Iqcfz9x5kLqZgNgSybTLcdwVpJpgMVs3//5Pv8NAWnFRWubDI0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Execution order first example\"\n        title=\"Execution order first example\"\n        src=\"/static/ca404c319c6fc595497d5dc097d469ff/fc1a1/execution-order-first-example.png\"\n        srcset=\"/static/ca404c319c6fc595497d5dc097d469ff/12f09/execution-order-first-example.png 148w,\n/static/ca404c319c6fc595497d5dc097d469ff/e4a3f/execution-order-first-example.png 295w,\n/static/ca404c319c6fc595497d5dc097d469ff/fc1a1/execution-order-first-example.png 466w\"\n        sizes=\"(max-width: 466px) 100vw, 466px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>until the call stack is empty.</p>\n<h2 id=\"queuing-function-execution\" style=\"position:relative;\"><a href=\"#queuing-function-execution\" aria-label=\"queuing function execution permalink\" class=\"autolink-headers before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Queuing function execution</h2>\n<p>The above example looks normal, there's nothing special about it: JavaScript finds things to execute, runs them in order.</p>\n<p>Let's see how to defer a function until the stack is clear.</p>\n<p>The use case of <code class=\"language-text\">setTimeout(() => {}, 0)</code> is to call a function, but execute it once every other function in the code has executed.</p>\n<p>Take this example:</p>\n<iframe\n  title=\"Queuing function execution\"\n  src=\"https://glitch.com/embed/#!/embed/nodejs-dev-0029-02?path=server.js&previewSize=20&attributionHidden=true&sidebarCollapsed=true\"\n  alt=\"nodejs-dev-0029-02 on Glitch\"\n  style=\"height: 400px; width: 100%; border: 0;\">\n</iframe>\n<!--```js\nconst bar = () => console.log('bar')\n\nconst baz = () => console.log('baz')\n\nconst foo = () => {\n  console.log('foo')\n  setTimeout(bar, 0)\n  baz()\n}\n\nfoo()\n```-->\n<p>This code prints, maybe surprisingly:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">foo\nbaz\nbar</code></pre></div>\n<p>When this code runs, first foo() is called. Inside foo() we first call setTimeout, passing <code class=\"language-text\">bar</code> as an argument, and we instruct it to run immediately as fast as it can, passing 0 as the timer. Then we call baz().</p>\n<p>At this point the call stack looks like this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/be55515b9343074d00b43de88c495331/966a0/call-stack-second-example.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 95.27027027027027%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAAsTAAALEwEAmpwYAAADLklEQVQ4y11UW28bRRT27+SBX9AHHqC8BAmQoKEFHgp5g6gNBdqqL0VCEYhc2ipNiZ0EgtPY8caO7WZ9iXd3dq5nLjvD2bVdIY5Gu+fMd87snO+b2ZpzzhirFCiljDEAGkMpJPpao29UZdZYDWUsZQlZ60IINZxwrkDz3mswQkic9b7Ap+CYZ31lCEmhSiR4TMaqstjgas6bItgQFBhCRWLCVPlUe8YEGGd9wIEQoxIgKOWlcrjWohi/GuZm7VE/Wz/NHp/Nfm6RwZSGopgj2uppJ5k1kvyQJPuU5aIqBrPZY2tnYrWpng14c5h9cUxWGvnqX3Q4pU+j/JszudqUjVj8fZl+Xc9u1elaI88IxxbKnl90k5/aZO2U7vVJf0J+ibLv2+xhh45ndOtidr9Fvm3mR1d5NCaPzrPv2vxhJyc5x/ZroHQoTLAqOFk47QyGOlgZCrBGe+/KsNDOWVtCEKwIHpBwpK7GqDDWAaqFCimNJGEiq3RDf8rzkciueJpxNKmsZQACNZwTxpkopZizom2lR5hPMMrvd3d/uHy+cbn7bPS6ADdPQ4IXUmFGsaS0MMXpuPvjePfu6Nf1yfZwOtm43Pqk/+iD3sZOfNKcdNdHf6yNNu/F25TxhVRdYk5Se5TaODfN+M3dzvFH53t3ovrwevbkonU7aqy0X76Mh4dvhl+2Gx939r86b6SEBewZd//gn+nNV+m7L/LHZ+nrQXbnkL3/Sn/aUP1xvnGSrtTljT29c0EPeuSzA/rhgf68LpKMlVIhb4WBoGUwsjw4AN4Irxk+NUChldcch9XKgApaeOAIgQLkpVbSW/IMojz/gOcZQy4kUoK+UlpIhUMhyULirUFI4Usv2JZLsoNZsh2qCSnAVbdnAUkI/2Ob5twvzzbuGtd6KxXNWXYlaAw01mQqpFTzNEQFFwBQwwvsljej2qr6TzHvHyeDaoyjHLPfFmMb+CMo2b53kry3T955zh60SNJLot304jfW26HXMen+ed3botEmHbXyOEqirbT7O4u2M8nLhWrWuWkuBkRGqZpQJZhkmWCJYqnC/mnG0WEznAfsiKYlRJPyJ4HF/wLrHR/AmkA8fQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Call stack second example\"\n        title=\"Call stack second example\"\n        src=\"/static/be55515b9343074d00b43de88c495331/fcda8/call-stack-second-example.png\"\n        srcset=\"/static/be55515b9343074d00b43de88c495331/12f09/call-stack-second-example.png 148w,\n/static/be55515b9343074d00b43de88c495331/e4a3f/call-stack-second-example.png 295w,\n/static/be55515b9343074d00b43de88c495331/fcda8/call-stack-second-example.png 590w,\n/static/be55515b9343074d00b43de88c495331/efc66/call-stack-second-example.png 885w,\n/static/be55515b9343074d00b43de88c495331/966a0/call-stack-second-example.png 944w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Here is the execution order for all the functions in our program:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 470px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/585ff3207d814911a7e44d55fbde483b/f96db/execution-order-second-example.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 181.08108108108107%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAkCAIAAAAGkY33AAAACXBIWXMAAAsTAAALEwEAmpwYAAAFRUlEQVRIx4WV+28UVRTH+wf4g8YfNPoDyA8a8fUv6A9GEzUxMZGKxsevRoWISCJtIbUWUCKGVjAaUcQHUNpCobSFvp+Udh/t7s7Mdnd2Hjv7mrkzs/N+73hnH1hKiyffnLn3Zs7MuZ85c26Tv5lVoLmW75pbyXNMeEsTvJXjuGyWKRSKLMspiuJ4nu/aA2hh3yK//7bQsgS+XgbtgTjo4bh1if8lkqvYZhCsKkqOYQiCJAmSLbElDmil3FcR5YPJ0t9h4u0p8ZHr1hPDxrZhE2rHiPnwdbt5WvCdanAtT6dqtm1rhunJQkdYeHVC/mSOfWVCenpYfX5Efa6qF0bUHUP6R1OcX3tzpWp37dlz0wUwTYJJUligQIgGyzRYqvraIEaXXMdu2gRVpeJ58FlQblXeFvKDYEEQSyWW5wVRFFVVdQNgzsRa4UgYdEaEIxHhmzAf+FAwPRoGJ6NcT4zxammXxTKO4wiCYhhG03SuUNTZfEtE3j3NH18g2+fo70Js+xx1PMJ1zlMdy2D7sNU8Lf4H7I55nmdYtifxbWHxtQnxy/nCpzPFfQvg4wnmQEj6fJ7dsyhuHzabp4DvGFsAc51VutSHgUsY35vke1DohYso15PkezEwtMbNp/OufT9g/maQKutUBQarShAEWZYhLV3XYaTrOUymSMV4apWnYyIdE6gVnoxxVKImQCB527aCYABAai2VSCAoikJgsMhYUCTnyvF+LjGajQwS0UEKGcsnByTsLwM7r2F/mtggsNx1FWY3TNd0vsxRszI6wKdmS4lRJnaDTs2y6Wsqds5M/mMkz9nJQcGuBUPCd4DVLq7rZNOFTIiDIsIAKrPM4eFSZqWqKIvHmHraWwP7HwuCISRIS9cN0zBMywrScL1kgZwoxG7ko9P5+GIevbVO83kkwiRd2wmCS6VSEktWKyzJ5BhO4G1ebcf7Xooc2RP//eXYsSfjB5+Jt+6Mt+yMtz4bb9sWP/B+/CffqtTTdl1Xb5golS1WPkBefDP6/c/Y8BvYiQcTex9D9j+KfAH1OLL/AeSzt9Au3/brFbZxN443no0co651EgM/kEOnyRunGoLjk+TwxcyMZzmbA6tA6o7vWz58/KaqOI0Kg9/WNM1aJ4H5w0gILAuKKyAT5QNFAB4FVQ+nXAYFVJrNuk71zYVCAdKCWkuu5XI5UZYqktmB97+YOPre6o+7Vrt2J041x7rfRU43r3a9g5x6KnHwwwCYV0/bsiypLEGD34wFnJYT9hHnd8W7u1euHF3p6Vq73hm60J0e+jZy6Th+9aHE3teRE3VgG7cd7MQbpJdaqN7DdP8hqr+N7Guj+lrJ3kN0/2Gi7zDZ/xs+XrkPMM+wfdXxNWcTrzmebtebvle1RmF6tRVe5AEvcECANdMQuDNmAagDg5AQBMGSa+k0zjCMpmq6qVJLYmpAwW9K6UEFHzDwqw1dM/ArVmqMt2ptqFbegAPwXbCBwv85m6foGWXpAoHdJuGPmThjIGd15GzV/6Ejv5pw0fbMpk1/F9u1sjEuN28y8zo9q1Kzyl2a0TKLrGWvC66sMzjRDU1Sy4omKXpNcsPLiiarmlIHtoF29bjxpHIZHgbivaoa7HmwFoPgfC6HImgqDTt/Bq7CGoUthg7x1KhBTankuEqMK9SkmhmTqQmVGFOIITM9BSy70bdhAy0Wi/B45Xm+mC/SDEFNKyuXc8ujseURFJ2jFocSqYVc6CaC32LjZ3T08v2Amdkon500mRmjJnpKy8LBrJGd0ekxIzMH7gK2YeeyLIllXiwL96osBR6eh/8Ch7p6XrwXM5QAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Execution order second example\"\n        title=\"Execution order second example\"\n        src=\"/static/585ff3207d814911a7e44d55fbde483b/f96db/execution-order-second-example.png\"\n        srcset=\"/static/585ff3207d814911a7e44d55fbde483b/12f09/execution-order-second-example.png 148w,\n/static/585ff3207d814911a7e44d55fbde483b/e4a3f/execution-order-second-example.png 295w,\n/static/585ff3207d814911a7e44d55fbde483b/f96db/execution-order-second-example.png 470w\"\n        sizes=\"(max-width: 470px) 100vw, 470px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Why is this happening?</p>\n<h2 id=\"the-message-queue\" style=\"position:relative;\"><a href=\"#the-message-queue\" aria-label=\"the message queue permalink\" class=\"autolink-headers before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The Message Queue</h2>\n<p>When setTimeout() is called, the Browser or Node.js starts the timer. Once the timer expires, in this case immediately as we put 0 as the timeout, the callback function is put in the <strong>Message Queue</strong>.</p>\n<p>The Message Queue is also where user-initiated events like click or keyboard events, or fetch responses are queued before your code has the opportunity to react to them. Or also DOM events like <code class=\"language-text\">onLoad</code>.</p>\n<p><strong>The loop gives priority to the call stack, and it first processes everything it finds in the call stack, and once there's nothing in there, it goes to pick up things in the message queue.</strong></p>\n<p>We don't have to wait for functions like <code class=\"language-text\">setTimeout</code>, fetch or other things to do their own work, because they are provided by the browser, and they live on their own threads. For example, if you set the <code class=\"language-text\">setTimeout</code> timeout to 2 seconds, you don't have to wait 2 seconds - the wait happens elsewhere.</p>\n<h2 id=\"es6-job-queue\" style=\"position:relative;\"><a href=\"#es6-job-queue\" aria-label=\"es6 job queue permalink\" class=\"autolink-headers before\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ES6 Job Queue</h2>\n<p>ECMAScript 2015 introduced the concept of the Job Queue, which is used by Promises (also introduced in ES6/ES2015). It's a way to execute the result of an async function as soon as possible, rather than being put at the end of the call stack.</p>\n<p>Promises that resolve before the current function ends will be executed right after the current function.</p>\n<p>I find nice the analogy of a rollercoaster ride at an amusement park: the message queue puts you at the back of the queue, behind all the other people, where you will have to wait for your turn, while the job queue is the fastpass ticket that lets you take another ride right after you finished the previous one.</p>\n<p>Example:</p>\n<iframe\n  title=\"ECMAScript 2015 Job Queue\"\n  src=\"https://glitch.com/embed/#!/embed/nodejs-dev-0029-03?path=server.js&previewSize=35&attributionHidden=true&sidebarCollapsed=true\"\n  alt=\"nodejs-dev-0029-03 on Glitch\"\n  style=\"height: 400px; width: 100%; border: 0;\">\n</iframe>\n<!--```js\nconst bar = () => console.log('bar')\n\nconst baz = () => console.log('baz')\n\nconst foo = () => {\n  console.log('foo')\n  setTimeout(bar, 0)\n  new Promise((resolve, reject) =>\n    resolve('should be right after baz, before bar')\n  ).then(resolve => console.log(resolve))\n  baz()\n}\n\nfoo()\n```\n\nThis prints\n\n```txt\nfoo\nbaz\nshould be right after baz, before bar\nbar\n```-->\n<p>That's a big difference between Promises (and Async/await, which is built on promises) and plain old asynchronous functions through <code class=\"language-text\">setTimeout()</code> or other platform APIs.</p>\n<p>Finally, here's what the call stack looks like for the example above:</p>\n<p><img src=\"/907f18a0288ad303ad59c035397a6f7e/call-stack-third-example.svg\" alt=\"Call stack third example\"></p>","tableOfContents":"<ul>\n<li><a href=\"#introduction\">Introduction</a></li>\n<li><a href=\"#blocking-the-event-loop\">Blocking the event loop</a></li>\n<li><a href=\"#the-call-stack\">The call stack</a></li>\n<li><a href=\"#a-simple-event-loop-explanation\">A simple event loop explanation</a></li>\n<li><a href=\"#queuing-function-execution\">Queuing function execution</a></li>\n<li><a href=\"#the-message-queue\">The Message Queue</a></li>\n<li><a href=\"#es6-job-queue\">ES6 Job Queue</a></li>\n</ul>","frontmatter":{"title":"The Node.js Event Loop","description":"The Event Loop is one of the most important aspects to understand about Node.js"},"fields":{"slug":"the-nodejs-event-loop","authors":["flaviocopes"," potch"," ZYSzys"," MylesBorins"," fhemberger"," LaRuaNa"," flaviocopes"," amiller-gh"," ahmadawais"]}}},"pageContext":{"slug":"the-nodejs-event-loop","next":{"slug":"understanding-process-nexttick","title":"Understanding process.nextTick()"},"previous":{"slug":"the-npx-nodejs-package-runner","title":"The npx Node.js Package Runner"},"relativePath":"0029-node-event-loop/index.md","navigationData":{"null":[{"title":"mock","slug":"/blog/0000/00/00/mock","section":null}],"Quick Start":[{"title":"Introduction to Node.js","slug":"introduction-to-nodejs","section":"Quick Start"},{"title":"A brief history of Node.js","slug":"a-brief-history-of-nodejs","section":"Quick Start"},{"title":"How to install Node.js","slug":"how-to-install-nodejs","section":"Quick Start"},{"title":"How much JavaScript do you need to know to use Node.js?","slug":"how-much-javascript-do-you-need-to-know-to-use-nodejs","section":"Quick Start"},{"title":"Differences between Node.js and the Browser","slug":"differences-between-nodejs-and-the-browser","section":"Quick Start"}],"Getting Started":[{"title":"The V8 JavaScript Engine","slug":"the-v8-javascript-engine","section":"Getting Started"},{"title":"Run Node.js scripts from the command line","slug":"run-nodejs-scripts-from-the-command-line","section":"Getting Started"},{"title":"How to exit from a Node.js program","slug":"how-to-exit-from-a-nodejs-program","section":"Getting Started"},{"title":"How to read environment variables from Node.js","slug":"how-to-read-environment-variables-from-nodejs","section":"Getting Started"},{"title":"How to use the Node.js REPL","slug":"how-to-use-the-nodejs-repl","section":"Getting Started"},{"title":"Node.js, accept arguments from the command line","slug":"nodejs-accept-arguments-from-the-command-line","section":"Getting Started"},{"title":"Output to the command line using Node.js","slug":"output-to-the-command-line-using-nodejs","section":"Getting Started"},{"title":"Accept input from the command line in Node.js","slug":"accept-input-from-the-command-line-in-nodejs","section":"Getting Started"},{"title":"Expose functionality from a Node.js file using exports","slug":"expose-functionality-from-a-nodejs-file-using-exports","section":"Getting Started"},{"title":"An introduction to the npm package manager","slug":"an-introduction-to-the-npm-package-manager","section":"Getting Started"},{"title":"Where does npm install the packages?","slug":"where-does-npm-install-the-packages","section":"Getting Started"},{"title":"How to use or execute a package installed using npm","slug":"how-to-use-or-execute-a-package-installed-using-npm","section":"Getting Started"},{"title":"The package.json guide","slug":"the-package-json-guide","section":"Getting Started"},{"title":"The package-lock.json file","slug":"the-package-lock-json-file","section":"Getting Started"},{"title":"Find the installed version of an npm package","slug":"find-the-installed-version-of-an-npm-package","section":"Getting Started"},{"title":"Install an older version of an npm package","slug":"install-an-older-version-of-an-npm-package","section":"Getting Started"},{"title":"Update all the Node.js dependencies to their latest version","slug":"update-all-the-nodejs-dependencies-to-their-latest-version","section":"Getting Started"},{"title":"Semantic Versioning using npm","slug":"semantic-versioning-using-npm","section":"Getting Started"},{"title":"Uninstalling npm packages","slug":"uninstalling-npm-packages","section":"Getting Started"},{"title":"npm global or local packages","slug":"npm-global-or-local-packages","section":"Getting Started"},{"title":"npm dependencies and devDependencies","slug":"npm-dependencies-and-devdependencies","section":"Getting Started"},{"title":"The npx Node.js Package Runner","slug":"the-npx-nodejs-package-runner","section":"Getting Started"},{"title":"The Node.js Event Loop","slug":"the-nodejs-event-loop","section":"Getting Started"},{"title":"Understanding process.nextTick()","slug":"understanding-process-nexttick","section":"Getting Started"},{"title":"Understanding setImmediate()","slug":"understanding-setimmediate","section":"Getting Started"},{"title":"Discover JavaScript Timers","slug":"discover-javascript-timers","section":"Getting Started"},{"title":"JavaScript Asynchronous Programming and Callbacks","slug":"javascript-asynchronous-programming-and-callbacks","section":"Getting Started"},{"title":"Understanding JavaScript Promises","slug":"understanding-javascript-promises","section":"Getting Started"},{"title":"Modern Asynchronous JavaScript with Async and Await","slug":"modern-asynchronous-javascript-with-async-and-await","section":"Getting Started"},{"title":"The Node.js Event emitter","slug":"the-nodejs-event-emitter","section":"Getting Started"},{"title":"Build an HTTP Server","slug":"build-an-http-server","section":"Getting Started"},{"title":"Making HTTP requests with Node.js","slug":"making-http-requests-with-nodejs","section":"Getting Started"},{"title":"Make an HTTP POST request using Node.js","slug":"make-an-http-post-request-using-nodejs","section":"Getting Started"},{"title":"Get HTTP request body data using Node.js","slug":"get-http-request-body-data-using-nodejs","section":"Getting Started"},{"title":"Working with file descriptors in Node.js","slug":"working-with-file-descriptors-in-nodejs","section":"Getting Started"},{"title":"Node.js file stats","slug":"nodejs-file-stats","section":"Getting Started"},{"title":"Node.js File Paths","slug":"nodejs-file-paths","section":"Getting Started"},{"title":"Reading files with Node.js","slug":"reading-files-with-nodejs","section":"Getting Started"},{"title":"Writing files with Node.js","slug":"writing-files-with-nodejs","section":"Getting Started"},{"title":"Working with folders in Node.js","slug":"working-with-folders-in-nodejs","section":"Getting Started"},{"title":"The Node.js fs module","slug":"the-nodejs-fs-module","section":"Getting Started"},{"title":"The Node.js path module","slug":"the-nodejs-path-module","section":"Getting Started"},{"title":"The Node.js os module","slug":"the-nodejs-os-module","section":"Getting Started"},{"title":"The Node.js events module","slug":"the-nodejs-events-module","section":"Getting Started"},{"title":"The Node.js http module","slug":"the-nodejs-http-module","section":"Getting Started"},{"title":"Node.js Buffers","slug":"nodejs-buffers","section":"Getting Started"},{"title":"Node.js Streams","slug":"nodejs-streams","section":"Getting Started"},{"title":"Node.js, the difference between development and production","slug":"nodejs-the-difference-between-development-and-production","section":"Getting Started"},{"title":"Error handling in Node.js","slug":"error-handling-in-nodejs","section":"Getting Started"},{"title":"How to log an object in Node.js","slug":"how-to-log-an-object-in-nodejs","section":"Getting Started"},{"title":"Node.js with TypeScript","slug":"nodejs-with-typescript","section":"Getting Started"}]}}},
    "staticQueryHashes": []}